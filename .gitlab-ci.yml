variables:
  CI_TOOL: gitlab-ci
  CI_WIKI: git@gite.lirmm.fr:multi-contact/mc_rbdyn_urdf_cpp.wiki.git
  APT_DEPENDENCIES: "libtinyxml2-dev libboost-all-dev python-dev"
  GIT_DEPENDENCIES: "jrl-umi3218/Eigen3ToPython jrl-umi3218/SpaceVecAlg jrl-umi3218/RBDyn"
  MASTER_PPA: ""

# Secured variable are stored in the project
# See: http://doc.gitlab.com/ci/variables/README.html

# Notifications (email/chatroom) are also handled by gitlab directly

before_script:
  - git submodule update --quiet --init --recursive
  - apt-get update -qq && apt-get install -qq python-pip && pip install --upgrade pip
  - ./.jrl-ci/dependencies/eigen-3.2
  - ./.jrl-ci/run before_install

build_gcc:
  stage: build
  script:
    - export CC=gcc
    - export CXX=g++
    - ./.jrl-ci/run build
    - export CI_UPDATE_WIKI=true
    - eval `ssh-agent`
    - ssh-add ~/.ssh/push_rsa
    - ./.jrl-ci/run after_success
  tags:
    - GCC

build_clang:
  stage: build
  script:
    - apt-get install -y clang
    - export CC=clang
    - export CXX=clang++
    - ./.jrl-ci/run build
    - ./.jrl-ci/run after_success
  allow_failure: true
  tags:
    - clang

package_trusty_amd64:
  stage: package
  before_script:
    - git submodule update --quiet --init --recursive
    - ./.packaging/setup_pbuilder.sh trusty amd64
  script:
    - ./.packaging/build_recipe.sh .mc_rbdyn_urdf_cpp.recipe trusty amd64
  artifacts:
    name: "mc_rbdyn_urdf_cpp_trusty_amd64"
    paths:
      - "*.deb"
    expire_in: '100y'
  tags:
    - GCC

package_trusty_i386:
  stage: package
  before_script:
    - git submodule update --quiet --init --recursive
    - ./.packaging/setup_pbuilder.sh trusty i386
  script:
    - ./.packaging/build_recipe.sh .mc_rbdyn_urdf_cpp.recipe trusty i386
  artifacts:
    name: "mc_rbdyn_urdf_cpp_trusty_i386"
    paths:
      - "*.deb"
    expire_in: '100y'
  tags:
    - GCC

package_xenial_amd64:
  stage: package
  before_script:
    - git submodule update --quiet --init --recursive
    - ./.packaging/setup_pbuilder.sh xenial amd64
  script:
    - ./.packaging/build_recipe.sh .mc_rbdyn_urdf_cpp.recipe xenial amd64
  artifacts:
    name: "mc_rbdyn_urdf_cpp_xenial_amd64"
    paths:
      - "*.deb"
    expire_in: '100y'
  tags:
    - GCC

package_xenial_i386:
  stage: package
  before_script:
    - git submodule update --quiet --init --recursive
    - ./.packaging/setup_pbuilder.sh xenial i386
  script:
    - ./.packaging/build_recipe.sh .mc_rbdyn_urdf_cpp.recipe xenial i386
  artifacts:
    name: "mc_rbdyn_urdf_cpp_xenial_i386"
    paths:
      - "*.deb"
    expire_in: '100y'
  tags:
    - GCC

stages:
  - build
  - package
